* env shebang
#!/usr/bin/env bash

* if variable is not defined as an environment variable, set to “”
${BUILD_IN_PROGRESS:-""}

* Loop against an array
#+begin_src 
DNS_ENTRY=foo.bar
# Create an array with names of all dns-internal-resolver servers in region
declare -a ns=(server1
server2
server3)
# Loop through array with ssh and dig for the current answer
for HOST in ${ns[@]}; do   
    dig PTR @${HOST} +noedns +noall +comm +ans ${DNS_ENTRY}" ;
done
#+end_src

* conditionals
#+begin_src 
BUILD_IN_PROGRESS=${BUILD_IN_PROGRESS:-""}
PREPROD=${PREPROD:-""}
declare -r CURRENT_LOG="/var/log/example.log"
declare -r SAMPLE_LOG="/tmp/sample.log"

if [ -z "${PREPROD}" ] && [ -z "${BUILD_IN_PROGRESS}" ]; then
  if [ ! -f "${CURRENT_LOG}" ]; then
    (echo "${LOG_SAMPLE} does not exist" && exit 1)
  else
    (timeout 5 tail -f  ${CURRENT_LOG} > ${SAMPLE_LOGS) || true \
    [[ ! $(grep -i error ${SAMPLE_LOG}) ]] || \
      (echo "Errors were found in logs!" && exit 1)
  fi
fi
#+end_src

* IFS syntax
#+begin_src 
person_age="Bob|27,Mary|31,Adrian|65,Liz|48"

IFS=',' read -ra user_pairs <<< "$person_age"

for up in "${user_pairs[@]}"; do
  IFS='|' read -ra user_pairs <<< "$up"
    echo "${user_pairs[0]} is ${user_pairs[1]} years old"
done
#+end_src

* -n vs. -z
# needs to be a string arg for -n
#+begin_src 
bash-3.2$ if [ -n "$UNSET" ]; then echo "I should do something"; fi
bash-3.2$ UNSET=nowset
bash-3.2$ if [ -n "$UNSET" ]; then echo "I should do something"; fi
I should do something
#+end_src

 #+begin_src 
 ENFORCE_FIREWALL=true
if [ -n "$ENFORCE_FIREWALL" ]; then
   export TAGS="enable-rules,enforce-firewall"
 else
   export TAGS="enables-rules"
 fi
 #+end_src

#+begin_src 
$ echo $TAGS
$ enable-rules,enforce-firewall
#+end_src

* Command line arguments and conditionals - from Red Hat cert lab
# Started with
#+begin_src 
#!/usr/bin/env bash

ARG=$1

if [$ARG = "me"]
    echo "Yes, I'm awesome.";
elsif [$ARG = "them"]
    echo "Okay, they are awesome, too.";
else
    echo "Usage ./awesome.sh me\|them"
#+end_src

# ended with
#+begin_src 
#!/usr/bin/env bash

ARG=$1

if [ "${ARG}" = "me" ]; then
    echo "Yes, I'm awesome."
elif [ "${ARG}" = "them" ]; then
    echo "Okay, they are awesome, too."
else
    echo "Usage ./awesome.sh me\|them"
fi
#+end_src


* set
set -eu

